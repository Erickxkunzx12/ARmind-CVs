{% extends "base.html" %}

{% block title %}Resultados del An√°lisis - ARMind CVs{% endblock %}

{% block extra_css %}
<style>
    /* Mejorar visibilidad de elementos con bordes prominentes */
    .score-circle {
        background-color: #ffffff !important;
        color: #2c3e50 !important;
        border: 4px solid #3498db !important;
        font-weight: 900 !important;
        text-shadow: none;
        box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
    }
    
    .card {
        box-shadow: 0 10px 30px rgba(0,0,0,0.15) !important;
        border: 3px solid #007bff !important;
        border-radius: 15px !important;
        background-color: #ffffff !important;
    }
    
    .card-header {
        font-weight: 600;
        border-radius: 12px 12px 0 0 !important;
        border-bottom: 2px solid rgba(255,255,255,0.3) !important;
    }
    
    /* Elementos de an√°lisis con bordes prominentes y texto visible */
    .strength-item, .weakness-item, .recommendation-item {
        border: 3px solid #010202 !important;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1) !important;
        border-radius: 8px !important;
    }
    
    .weakness-item {
        border: 3px solid #010202 !important;
    }
    
    .recommendation-item {
        border: 3px solid #010202 !important;
    }
    
    .strength-item p, .weakness-item p, .recommendation-item p {
        color: #212529 !important;
        font-weight: 600 !important;
        font-size: 15px !important;
        line-height: 1.6 !important;
        margin: 0 !important;
    }
    
    /* Asegurar visibilidad de iconos */
    .strength-item i, .weakness-item i, .recommendation-item i {
        opacity: 1 !important;
    }
    
    .badge {
        font-weight: 700 !important;
        font-size: 13px !important;
        padding: 8px 12px !important;
        border: 2px solid rgba(255,255,255,0.3) !important;
    }
    
    .tip-card {
        border: 2px solid #dee2e6 !important;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1) !important;
        border-radius: 8px !important;
    }
    
    /* Mejorar visibilidad de palabras clave */
    .keyword-badge {
        border: 2px solid #e9ecef !important;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1) !important;
        border-radius: 6px !important;
    }
    
    /* Mejorar contraste en gr√°ficos */
    canvas {
        background-color: #ffffff;
        border-radius: 8px;
        border: 2px solid #e9ecef;
    }
    
    .progress-bar {
        background-color: #3498db !important;
        color: #ffffff !important;
        font-weight: 600;
    }
    
    /* Asegurar que todos los n√∫meros sean visibles */
    h4, h5, .display-4, .display-5 {
        color: #2c3e50 !important;
        font-weight: 700 !important;
    }
    
    .text-white h4, .text-white h5 {
        color: #ffffff !important;
        font-weight: 700 !important;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3) !important;
    }
    
    .bg-gradient-primary {
        background: linear-gradient(251deg, #667eea 0%, #0e1721 100%) !important;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2) !important;
        border-radius: 15px !important;
    }
    
    .bg-gradient-primary .score-circle {
        background-color: #ffffff !important;
        color: #667eea !important;
        border: 4px solid #ffffff !important;
        box-shadow: 0 8px 25px rgba(0,0,0,0.2) !important;
    }
    
    /* Mejorar visibilidad de n√∫meros en tarjetas */
    .bg-gradient-primary .card-body h4 {
        font-size: 2.5rem !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.4) !important;
    }
    
    .bg-gradient-primary .card-body p {
        font-weight: 600 !important;
        color: rgba(255,255,255,0.9) !important;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.3) !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="fw-bold mb-2">
                        <i class="fas fa-chart-line me-2 text-success"></i>Resultados del An√°lisis
                    </h2>
                    <p class="text-muted mb-0">
                        An√°lisis completo de tu curr√≠culum realizado por nuestro sistema de IA
                    </p>
                </div>
                <div>
                    <a href="{{ url_for('analyze_cv') }}" class="btn btn-outline-primary me-2">
                        <i class="fas fa-plus me-2"></i>Nuevo An√°lisis
                    </a>
                    <a href="{{ url_for('dashboard') }}" class="btn btn-primary">
                        <i class="fas fa-home me-2"></i>Dashboard
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Score Overview -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="card bg-gradient-primary text-white">
                <div class="card-body py-4">
                    <div class="row align-items-center">
                        <div class="col-md-3 text-center">
                            <div class="score-circle bg-white text-primary d-inline-flex align-items-center justify-content-center mb-3" 
                                 style="width: 120px; height: 120px; font-size: 2.5rem; font-weight: bold;">
                                {{ (analysis.score or 0) | default(0) }}%
                            </div>
                            <h5 class="mb-0">Puntuaci√≥n General</h5>
                        </div>
                        <div class="col-md-9">
                            <div class="row">
                                <div class="col-md-4 text-center mb-3">
                                    <h4 class="mb-1">{{ analysis.strengths|length }}</h4>
                                    <p class="mb-0">Fortalezas Identificadas</p>
                                </div>
                                <div class="col-md-4 text-center mb-3">
                                    <h4 class="mb-1">{{ analysis.weaknesses|length }}</h4>
                                    <p class="mb-0">√Åreas de Mejora</p>
                                </div>
                                <div class="col-md-4 text-center mb-3">
                                    <h4 class="mb-1">{{ analysis.recommendations|length }}</h4>
                                    <p class="mb-0">Recomendaciones</p>
                                </div>
                            </div>
                            <div class="mt-3">
                                <div class="progress" style="height: 20px; background-color: rgba(255,255,255,0.3); border-radius: 10px;">
                                    <div class="progress-bar" 
                                         style="width: {{ (analysis.score or 0) | default(0) }}%; background-color: #ffffff; color: #667eea; font-weight: 700; text-shadow: none;" 
                                         id="scoreProgress">
                                        {{ (analysis.score or 0) | default(0) }}%
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Detailed Analysis -->
    <div class="row">
        <!-- Enhanced Strengths -->
        <div class="col-lg-4 mb-4">
            <div class="card h-100 shadow-sm">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-thumbs-up me-2"></i>Fortalezas Identificadas
                    </h5>
                    <small class="opacity-75">{{ analysis.strengths|length or 0 }} puntos fuertes detectados</small>
                </div>
                <div class="card-body">
                    {% if analysis.strengths %}
                        {% for strength in analysis.strengths %}
                        <div class="strength-item mb-3 p-3 bg-light rounded border-start border-success border-3">
                            <div class="d-flex align-items-start">
                                <div class="me-3">
                                    <i class="fas fa-check-circle text-success fa-lg"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <p class="mb-2 fw-semibold text-success">{{ strength }}</p>
                                    {% if loop.index == 1 %}
                                    <div class="detailed-explanation mb-2">
                                        <small class="text-muted d-block mb-1">üí° <strong>Por qu√© es importante:</strong> Esta fortaleza demuestra tu capacidad para generar resultados medibles, algo que los reclutadores valoran enormemente.</small>
                                        <small class="text-muted d-block mb-1">üìä <strong>Ejemplo mejorado:</strong> "Lider√© un equipo de 15 personas, aumentando la productividad en un 25% y reduciendo los tiempos de entrega en 3 d√≠as"</small>
                                        <small class="text-muted d-block">üéØ <strong>Impacto en tu candidatura:</strong> Te posiciona en el top 22% de candidatos que cuantifican sus logros</small>
                                    </div>
                                    {% elif loop.index == 2 %}
                                    <div class="detailed-explanation mb-2">
                                        <small class="text-muted d-block mb-1">üîç <strong>An√°lisis detallado:</strong> Esta competencia es altamente valorada en tu sector y te diferencia significativamente de otros candidatos.</small>
                                        <small class="text-muted d-block mb-1">üìà <strong>Potencial de crecimiento:</strong> Puede aumentar tus posibilidades de conseguir entrevistas en un 23-35%</small>
                                        <small class="text-muted d-block">üíº <strong>Recomendaci√≥n:</strong> Destaca esta fortaleza en tu resumen profesional y en ejemplos espec√≠ficos de logros</small>
                                    </div>
                                    {% elif loop.index == 3 %}
                                    <div class="detailed-explanation mb-2">
                                        <small class="text-muted d-block mb-1">‚≠ê <strong>Ventaja competitiva:</strong> Esta habilidad es especialmente relevante para roles de liderazgo y gesti√≥n de proyectos.</small>
                                        <small class="text-muted d-block mb-1">üöÄ <strong>Oportunidades:</strong> Considera aplicar a posiciones que requieran esta competencia espec√≠fica</small>
                                        <small class="text-muted d-block">üìù <strong>Mejora sugerida:</strong> A√±ade contexto sobre el impacto de esta fortaleza en resultados empresariales</small>
                                    </div>
                                    {% else %}
                                    <div class="detailed-explanation mb-2">
                                        <small class="text-muted d-block mb-1">‚ú® <strong>Valor a√±adido:</strong> Esta fortaleza complementa perfectamente tu perfil profesional y aumenta tu atractivo como candidato.</small>
                                        <small class="text-muted d-block mb-1">üé™ <strong>Diferenciaci√≥n:</strong> Te ayuda a destacar en procesos de selecci√≥n competitivos</small>
                                        <small class="text-muted d-block">üîß <strong>Optimizaci√≥n:</strong> Considera incluir ejemplos espec√≠ficos que demuestren esta competencia en acci√≥n</small>
                                    </div>
                                    {% endif %}
                                    <div class="action-tags mt-2">
                                        <span class="badge bg-success bg-opacity-25 text-success me-1">Mantener</span>
                                        <span class="badge bg-info bg-opacity-25 text-info me-1">Destacar m√°s</span>
                                        {% if loop.index <= 2 %}
                                        <span class="badge bg-warning bg-opacity-25 text-warning">Prioridad alta</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        
                        <!-- Strength Summary -->
                        <div class="mt-4 p-3 bg-success bg-opacity-10 rounded">
                            <h6 class="text-success mb-2"><i class="fas fa-star me-2"></i>Resumen de Fortalezas</h6>
                            <div class="row text-center">
                                <div class="col-6">
                                    <div class="text-success fw-bold">{{ ((analysis.strengths|length / 10) * 100) | round | int }}%</div>
                                    <small class="text-muted">Cobertura de Competencias</small>
                                </div>
                                <div class="col-6">
                                    <div class="text-success fw-bold">{{ (analysis.strength_score or 85) }}%</div>
                                    <small class="text-muted">Puntuaci√≥n de Fortalezas</small>
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-search fa-2x text-muted mb-3"></i>
                            <p class="text-muted mb-2">No se identificaron fortalezas espec√≠ficas</p>
                            <small class="text-muted">Esto puede indicar que el CV necesita m√°s detalles sobre logros y competencias</small>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Enhanced Weaknesses -->
        <div class="col-lg-4 mb-4">
            <div class="card h-100 shadow-sm">
                <div class="card-header bg-warning text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-exclamation-triangle me-2"></i>√Åreas de Mejora
                    </h5>
                    <small class="opacity-75">{{ analysis.weaknesses|length or 0 }} oportunidades de optimizaci√≥n</small>
                </div>
                <div class="card-body">
                    {% if analysis.weaknesses %}
                        {% for weakness in analysis.weaknesses %}
                        <div class="weakness-item mb-3 p-3 bg-light rounded border-start border-warning border-3">
                            <div class="d-flex align-items-start">
                                <div class="me-3">
                                    <i class="fas fa-exclamation-circle text-warning fa-lg"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <p class="mb-2 fw-semibold text-warning">{{ weakness }}</p>
                                    {% if loop.index == 1 %}
                                    <div class="detailed-solution mb-2">
                                        <small class="text-muted d-block mb-1">üîß <strong>Soluci√≥n detallada:</strong> Identifica 3-4 logros espec√≠ficos de tu experiencia y cuantif√≠calos con n√∫meros, porcentajes o m√©tricas concretas.</small>
                                        <small class="text-muted d-block mb-1">üìù <strong>Ejemplo de mejora:</strong> Cambia "Responsable de ventas" por "Aument√© las ventas en un 35% (‚Ç¨150K adicionales) en 8 meses mediante estrategias de cross-selling"</small>
                                        <small class="text-muted d-block mb-1">‚è±Ô∏è <strong>Tiempo de implementaci√≥n:</strong> 45-60 minutos para revisar y mejorar toda la secci√≥n de experiencia</small>
                                        <small class="text-muted d-block">üìä <strong>Impacto esperado:</strong> +18-25% en puntuaci√≥n general y mayor atractivo para reclutadores</small>
                                    </div>
                                    {% elif loop.index == 2 %}
                                    <div class="detailed-solution mb-2">
                                        <small class="text-muted d-block mb-1">üéØ <strong>An√°lisis del problema:</strong> Esta debilidad puede estar limitando significativamente tus oportunidades de conseguir entrevistas.</small>
                                        <small class="text-muted d-block mb-1">üöÄ <strong>Plan de acci√≥n:</strong> Dedica 30-45 minutos a investigar palabras clave espec√≠ficas de tu sector y roles objetivo</small>
                                        <small class="text-muted d-block mb-1">üîç <strong>Herramientas recomendadas:</strong> Analiza 5-7 ofertas de trabajo similares y extrae las competencias m√°s mencionadas</small>
                                        <small class="text-muted d-block">üìà <strong>Resultado esperado:</strong> Mejora del 20-30% en compatibilidad ATS y mayor visibilidad en b√∫squedas</small>
                                    </div>
                                    {% elif loop.index == 3 %}
                                    <div class="detailed-solution mb-2">
                                        <small class="text-muted d-block mb-1">‚ö†Ô∏è <strong>Impacto en tu candidatura:</strong> Esta √°rea de mejora puede estar afectando la primera impresi√≥n que causas en los reclutadores.</small>
                                        <small class="text-muted d-block mb-1">üîÑ <strong>Estrategia de mejora:</strong> Revisa la estructura, formato y consistencia visual de tu CV</small>
                                        <small class="text-muted d-block mb-1">‚ú® <strong>Mejoras espec√≠ficas:</strong> Unifica fuentes, espaciado, y aseg√∫rate de que la informaci√≥n m√°s importante est√© destacada</small>
                                        <small class="text-muted d-block">üé® <strong>Tiempo estimado:</strong> 25-40 minutos para optimizar el formato y dise√±o</small>
                                    </div>
                                    {% else %}
                                    <div class="detailed-solution mb-2">
                                        <small class="text-muted d-block mb-1">üîç <strong>Oportunidad de mejora:</strong> Aunque no es cr√≠tica, abordar esta √°rea puede darte una ventaja competitiva adicional.</small>
                                        <small class="text-muted d-block mb-1">üìã <strong>Pasos recomendados:</strong> Revisa esta secci√≥n espec√≠fica y considera a√±adir m√°s detalles o contexto</small>
                                        <small class="text-muted d-block mb-1">‚≠ê <strong>Beneficio esperado:</strong> Perfeccionamiento general del perfil y mayor profesionalismo</small>
                                        <small class="text-muted d-block">‚è∞ <strong>Inversi√≥n de tiempo:</strong> 15-25 minutos para pulir este aspecto</small>
                                    </div>
                                    {% endif %}
                                    <div class="action-tags mt-2">
                                        {% if loop.index <= 2 %}
                                        <span class="badge bg-danger bg-opacity-25 text-danger me-1">Urgente</span>
                                        <span class="badge bg-warning bg-opacity-25 text-warning me-1">Alto impacto</span>
                                        {% else %}
                                        <span class="badge bg-info bg-opacity-25 text-info me-1">Mejorar</span>
                                        <span class="badge bg-secondary bg-opacity-25 text-secondary me-1">Medio impacto</span>
                                        {% endif %}
                                        <span class="badge bg-primary bg-opacity-25 text-primary">{{ (loop.index * 15) + 15 }} min</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        
                        <!-- Improvement Priority -->
                        <div class="mt-4 p-3 bg-warning bg-opacity-10 rounded">
                            <h6 class="text-warning mb-2"><i class="fas fa-target me-2"></i>Prioridad de Mejora</h6>
                            <div class="row text-center">
                                <div class="col-6">
                                    <div class="text-warning fw-bold">{{ (analysis.improvement_urgency or 'Media') }}</div>
                                    <small class="text-muted">Urgencia</small>
                                </div>
                                <div class="col-6">
                                    <div class="text-warning fw-bold">{{ (analysis.improvement_impact or 'Alto') }}</div>
                                    <small class="text-muted">Impacto Potencial</small>
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-trophy fa-2x text-success mb-3"></i>
                            <p class="text-success mb-2 fw-semibold">¬°Excelente! No se encontraron debilidades significativas</p>
                            <small class="text-muted">Tu CV est√° muy bien optimizado. Considera peque√±os ajustes para perfeccionarlo a√∫n m√°s.</small>
                            <div class="mt-3 p-2 bg-success bg-opacity-10 rounded">
                                <small class="text-success">üí° <strong>Tip:</strong> Mant√©n tu CV actualizado con nuevos logros y certificaciones</small>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Enhanced Recommendations -->
        <div class="col-lg-4 mb-4">
            <div class="card h-100 shadow-sm">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-lightbulb me-2"></i>Recomendaciones Estrat√©gicas
                    </h5>
                    <small class="opacity-75">{{ analysis.recommendations|length or 0 }} acciones para optimizar</small>
                </div>
                <div class="card-body">
                    {% if analysis.recommendations %}
                        {% for recommendation in analysis.recommendations %}
                        <div class="recommendation-item mb-4 p-3 bg-light rounded border-start border-info border-3">
                            <div class="d-flex align-items-start">
                                <div class="me-3">
                                    <span class="badge bg-info rounded-pill fs-6">{{ loop.index }}</span>
                                </div>
                                <div class="flex-grow-1">
                                    <p class="mb-2 fw-semibold text-info">{{ recommendation }}</p>
                                    {% if loop.index == 1 %}
                                    <div class="detailed-recommendation mb-3">
                                        <div class="mb-2">
                                            <small class="text-muted d-block mb-1">üéØ <strong>Objetivo:</strong> Transformar descripciones gen√©ricas en logros espec√≠ficos y medibles que demuestren tu impacto real.</small>
                                            <small class="text-muted d-block mb-1">üìä <strong>Ejemplo detallado:</strong></small>
                                            <div class="ps-3 border-start border-2 border-secondary">
                                                <small class="text-danger d-block">‚ùå <strong>Antes:</strong> "Responsable de gesti√≥n de equipo y mejora de procesos"</small>
                                                <small class="text-success d-block">‚úÖ <strong>Despu√©s:</strong> "Lider√© un equipo de 12 personas, implement√© 3 nuevos procesos que redujeron costos en ‚Ç¨45K anuales y aument√© la satisfacci√≥n del cliente del 78% al 94% en 8 meses"</small>
                                            </div>
                                        </div>
                                        <small class="text-muted d-block mb-1">üöÄ <strong>Impacto esperado:</strong> Los CVs con logros cuantificados tienen 67% m√°s probabilidades de conseguir entrevistas</small>
                                        <small class="text-muted d-block">üìù <strong>Plan de acci√≥n:</strong> Revisa cada punto de tu experiencia y a√±ade al menos 2 m√©tricas espec√≠ficas por rol</small>
                                    </div>
                                    <div class="action-plan p-2 bg-success bg-opacity-10 rounded">
                                        <small class="text-success d-block mb-1"><strong>Pasos espec√≠ficos:</strong></small>
                                        <small class="text-muted d-block">1. Identifica 3-4 logros principales por trabajo (10 min)</small>
                                        <small class="text-muted d-block">2. Busca n√∫meros, porcentajes, cantidades (15 min)</small>
                                        <small class="text-muted d-block">3. Reescribe usando la f√≥rmula: Acci√≥n + Resultado + Impacto (20 min)</small>
                                    </div>
                                    <div class="mt-2">
                                        <span class="badge bg-danger bg-opacity-75 text-dark">Prioridad Cr√≠tica</span>
                                        <span class="badge bg-light text-dark">45 min</span>
                                        <span class="badge bg-success bg-opacity-50 text-dark">+25% efectividad</span>
                                    </div>
                                    {% elif loop.index == 2 %}
                                    <div class="detailed-recommendation mb-3">
                                        <div class="mb-2">
                                            <small class="text-muted d-block mb-1">üí™ <strong>Prop√≥sito:</strong> Reemplazar verbos pasivos por verbos de acci√≥n que transmitan liderazgo, iniciativa y resultados.</small>
                                            <small class="text-muted d-block mb-1">üìù <strong>Transformaci√≥n de verbos:</strong></small>
                                            <div class="ps-3 border-start border-2 border-secondary">
                                                <small class="text-warning d-block">‚ö†Ô∏è <strong>Evitar:</strong> "fui responsable", "particip√©", "ayud√©", "estuve involucrado"</small>
                                                <small class="text-success d-block">‚úÖ <strong>Usar:</strong> "lider√©", "implement√©", "optimic√©", "desarroll√©", "aument√©", "reduje", "cre√©"</small>
                                            </div>
                                        </div>
                                        <small class="text-muted d-block mb-1">üéØ <strong>Ejemplo pr√°ctico:</strong> "Particip√© en proyecto de digitalizaci√≥n" ‚Üí "Lider√© la digitalizaci√≥n de 5 procesos clave, reduciendo tiempo de procesamiento en 40%"</small>
                                        <small class="text-muted d-block">üìà <strong>Beneficio:</strong> Los verbos de acci√≥n aumentan la percepci√≥n de liderazgo en un 43%</small>
                                    </div>
                                    <div class="action-plan p-2 bg-warning bg-opacity-10 rounded">
                                        <small class="text-warning d-block mb-1"><strong>Estrategia de implementaci√≥n:</strong></small>
                                        <small class="text-muted d-block">1. Identifica todos los verbos pasivos en tu CV (5 min)</small>
                                        <small class="text-muted d-block">2. Selecciona verbos de acci√≥n espec√≠ficos para tu sector (10 min)</small>
                                        <small class="text-muted d-block">3. Reescribe cada bullet point con verbos potentes (25 min)</small>
                                    </div>
                                    <div class="mt-2">
                                        <span class="badge bg-warning bg-opacity-75 text-dark">Prioridad Alta</span>
                                        <span class="badge bg-light text-dark">40 min</span>
                                        <span class="badge bg-info bg-opacity-50 text-dark">+18% impacto</span>
                                    </div>
                                    {% elif loop.index == 3 %}
                                    <div class="detailed-recommendation mb-3">
                                        <div class="mb-2">
                                            <small class="text-muted d-block mb-1">üîç <strong>Investigaci√≥n estrat√©gica:</strong> Analizar ofertas de trabajo similares para identificar las palabras clave m√°s valoradas en tu sector.</small>
                                            <small class="text-muted d-block mb-1">üìã <strong>Metodolog√≠a recomendada:</strong></small>
                                            <div class="ps-3 border-start border-2 border-secondary">
                                                <small class="text-muted d-block">‚Ä¢ Recopila 5-7 ofertas de trabajo de tu inter√©s</small>
                                                <small class="text-muted d-block">‚Ä¢ Identifica competencias t√©cnicas repetidas</small>
                                                <small class="text-muted d-block">‚Ä¢ Anota habilidades blandas m√°s solicitadas</small>
                                                <small class="text-muted d-block">‚Ä¢ Incorpora estas keywords naturalmente en tu CV</small>
                                            </div>
                                        </div>
                                        <small class="text-muted d-block mb-1">ü§ñ <strong>Optimizaci√≥n ATS:</strong> Los sistemas autom√°ticos buscan coincidencias exactas de keywords, aumentando tus posibilidades de pasar filtros iniciales</small>
                                        <small class="text-muted d-block">üìä <strong>Estad√≠stica clave:</strong> CVs optimizados con keywords relevantes tienen 58% m√°s probabilidades de ser seleccionados</small>
                                    </div>
                                    <div class="action-plan p-2 bg-info bg-opacity-10 rounded">
                                        <small class="text-info d-block mb-1"><strong>Hoja de ruta:</strong></small>
                                        <small class="text-muted d-block">1. Busca y guarda 5-7 ofertas objetivo (15 min)</small>
                                        <small class="text-muted d-block">2. Extrae y categoriza keywords por frecuencia (20 min)</small>
                                        <small class="text-muted d-block">3. Integra keywords de forma natural en tu CV (25 min)</small>
                                    </div>
                                    <div class="mt-2">
                                        <span class="badge bg-info bg-opacity-75 text-dark">Prioridad Media</span>
                                        <span class="badge bg-light text-dark">60 min</span>
                                        <span class="badge bg-primary bg-opacity-50 text-dark">+22% visibilidad ATS</span>
                                    </div>
                                    {% else %}
                                    <div class="detailed-recommendation mb-3">
                                        <div class="mb-2">
                                            <small class="text-muted d-block mb-1">‚ú® <strong>Optimizaci√≥n avanzada:</strong> Esta recomendaci√≥n te ayudar√° a pulir aspectos espec√≠ficos que pueden marcar la diferencia en procesos competitivos.</small>
                                            <small class="text-muted d-block mb-1">üéØ <strong>Enfoque personalizado:</strong> Adapta esta mejora seg√∫n tu sector y nivel de experiencia para maximizar su efectividad.</small>
                                            <small class="text-muted d-block">üìà <strong>Valor agregado:</strong> Aunque no es cr√≠tica, implementar esta recomendaci√≥n te dar√° una ventaja competitiva adicional</small>
                                        </div>
                                    </div>
                                    <div class="action-plan p-2 bg-secondary bg-opacity-10 rounded">
                                        <small class="text-secondary d-block mb-1"><strong>Implementaci√≥n sugerida:</strong></small>
                                        <small class="text-muted d-block">1. Eval√∫a la relevancia para tu perfil (5 min)</small>
                                        <small class="text-muted d-block">2. Planifica los cambios necesarios (10 min)</small>
                                        <small class="text-muted d-block">3. Implementa las mejoras gradualmente (20 min)</small>
                                    </div>
                                    <div class="mt-2">
                                        <span class="badge bg-secondary bg-opacity-75 text-dark">Prioridad Baja</span>
                                        <span class="badge bg-light text-dark">35 min</span>
                                        <span class="badge bg-secondary bg-opacity-50 text-dark">+8% refinamiento</span>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        
                        <!-- Action Plan Summary -->
                        <div class="mt-4 p-3 bg-info bg-opacity-10 rounded">
                            <h6 class="text-info mb-2"><i class="fas fa-clipboard-check me-2"></i>Plan de Acci√≥n</h6>
                            <div class="row text-center">
                                <div class="col-6">
                                    <div class="text-info fw-bold">{{ ((analysis.recommendations|length * 20) + 15) }} min</div>
                                    <small class="text-muted">Tiempo Total Estimado</small>
                                </div>
                                <div class="col-6">
                                    <div class="text-info fw-bold">+{{ (analysis.recommendations|length * 8) }}%</div>
                                    <small class="text-muted">Mejora Esperada</small>
                                </div>
                            </div>
                            <div class="mt-3">
                                <div class="progress" style="height: 6px;">
                                    <div class="progress-bar bg-info" style="width: {{ (analysis.implementation_progress or 25) }}%"></div>
                                </div>
                                <small class="text-muted">Progreso de implementaci√≥n sugerido</small>
                            </div>
                        </div>
                    {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-star fa-2x text-success mb-3"></i>
                            <p class="text-success mb-2 fw-semibold">¬°Tu CV est√° en excelente forma!</p>
                            <small class="text-muted">Mant√©n estas buenas pr√°cticas y actualiza regularmente</small>
                            <div class="mt-3 p-3 bg-success bg-opacity-10 rounded">
                                <h6 class="text-success mb-2">Consejos de Mantenimiento:</h6>
                                <ul class="list-unstyled mb-0 small">
                                    <li class="mb-1">‚úÖ Actualiza logros cada 3 meses</li>
                                    <li class="mb-1">‚úÖ Revisa keywords del sector</li>
                                    <li class="mb-0">‚úÖ Adapta para cada aplicaci√≥n</li>
                                </ul>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Gr√°ficos Principales de An√°lisis -->
    <div class="row mb-5">
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-pie me-2"></i>Distribuci√≥n de Puntuaci√≥n General
                    </h5>
                </div>
                <div class="card-body">
                    <canvas id="scoreChart" width="400" height="300"></canvas>
                    <div class="mt-3">
                        <p class="text-muted mb-3"><strong>Interpretaci√≥n:</strong> Este gr√°fico circular muestra c√≥mo se distribuye tu puntuaci√≥n general del CV en diferentes rangos de calidad.</p>
                        <div class="row text-center">
                            <div class="col-4">
                                <div class="border rounded p-2 bg-light">
                                    <small class="text-muted d-block">Excelente</small>
                                    <div class="text-success fw-bold">80-100%</div>
                                    <small class="text-muted">CV competitivo</small>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="border rounded p-2 bg-light">
                                    <small class="text-muted d-block">Bueno</small>
                                    <div class="text-warning fw-bold">60-79%</div>
                                    <small class="text-muted">Necesita mejoras</small>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="border rounded p-2 bg-light">
                                    <small class="text-muted d-block">Mejorable</small>
                                    <div class="text-danger fw-bold">0-59%</div>
                                    <small class="text-muted">Requiere atenci√≥n</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-radar me-2"></i>An√°lisis Multidimensional
                    </h5>
                </div>
                <div class="card-body">
                    <canvas id="radarChart" width="400" height="300"></canvas>
                    <div class="mt-3">
                        <p class="text-muted mb-3"><strong>Interpretaci√≥n:</strong> Este gr√°fico radar eval√∫a tu CV en 5 dimensiones clave. Cada eje representa un aspecto fundamental que los reclutadores consideran.</p>
                        <div class="row text-center">
                            <div class="col-6 mb-2">
                                <small class="text-primary">üìù <strong>Contenido:</strong> Relevancia y calidad de la informaci√≥n</small>
                            </div>
                            <div class="col-6 mb-2">
                                <small class="text-info">üé® <strong>Formato:</strong> Estructura y presentaci√≥n visual</small>
                            </div>
                            <div class="col-6 mb-2">
                                <small class="text-warning">üîç <strong>Keywords:</strong> Optimizaci√≥n para sistemas ATS</small>
                            </div>
                            <div class="col-6 mb-2">
                                <small class="text-success">üíº <strong>Experiencia:</strong> Relevancia profesional</small>
                            </div>
                            <div class="col-12">
                                <small class="text-secondary">üéØ <strong>Competencias:</strong> Habilidades t√©cnicas y blandas</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Gr√°ficos de An√°lisis Espec√≠fico -->
    <div class="row mb-5">
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-robot me-2"></i>Compatibilidad con Sistemas ATS
                    </h5>
                </div>
                <div class="card-body">
                    <canvas id="atsChart" width="400" height="300"></canvas>
                    <div class="mt-3">
                        <p class="text-muted mb-3"><strong>¬øQu√© es ATS?</strong> Los Applicant Tracking Systems son software que las empresas usan para filtrar CVs autom√°ticamente antes de que lleguen a un reclutador humano.</p>
                        <div class="progress mb-2" style="height: 12px;">
                            <div class="progress-bar bg-info" style="width: {{ (analysis.ats_compatibility_score or 75) }}%"></div>
                        </div>
                        <div class="d-flex justify-content-between">
                            <small class="text-muted">Probabilidad de pasar filtros autom√°ticos</small>
                            <strong class="text-info">{{ (analysis.ats_compatibility_score or 75) }}%</strong>
                        </div>
                        <div class="mt-2">
                            {% if (analysis.ats_compatibility_score or 75) >= 80 %}
                            <small class="text-success">‚úÖ Excelente: Tu CV tiene alta probabilidad de pasar los filtros ATS</small>
                            {% elif (analysis.ats_compatibility_score or 75) >= 60 %}
                            <small class="text-warning">‚ö†Ô∏è Bueno: Algunas mejoras pueden aumentar tu compatibilidad ATS</small>
                            {% else %}
                            <small class="text-danger">‚ùå Mejorable: Tu CV necesita optimizaci√≥n para sistemas ATS</small>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm">
                <div class="card-header bg-warning text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-bar me-2"></i>An√°lisis de Competencias
                    </h5>
                </div>
                <div class="card-body">
                    <canvas id="skillsChart" width="400" height="300"></canvas>
                    <div class="mt-3">
                        <p class="text-muted mb-3"><strong>Balance de Habilidades:</strong> Un CV efectivo debe mostrar tanto competencias t√©cnicas espec√≠ficas como habilidades interpersonales.</p>
                        <div class="row">
                            <div class="col-6 text-center">
                                <div class="border rounded p-3 bg-light">
                                    <div class="text-info fw-bold h4">{{ (analysis.technical_skills_count or 15) }}</div>
                                    <small class="text-muted d-block"><strong>Habilidades T√©cnicas</strong></small>
                                    <small class="text-muted">Conocimientos espec√≠ficos del √°rea</small>
                                </div>
                            </div>
                            <div class="col-6 text-center">
                                <div class="border rounded p-3 bg-light">
                                    <div class="text-warning fw-bold h4">{{ (analysis.soft_skills_count or 8) }}</div>
                                    <small class="text-muted d-block"><strong>Habilidades Blandas</strong></small>
                                    <small class="text-muted">Competencias interpersonales</small>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3">
                            {% set skill_ratio = ((analysis.soft_skills_count or 8) / (analysis.technical_skills_count or 15) * 100) | round %}
                            {% if skill_ratio >= 40 and skill_ratio <= 60 %}
                            <small class="text-success">‚úÖ Balance ideal entre habilidades t√©cnicas y blandas</small>
                            {% elif skill_ratio < 40 %}
                            <small class="text-warning">‚ö†Ô∏è Considera agregar m√°s habilidades interpersonales</small>
                            {% else %}
                            <small class="text-info">üí° Podr√≠as enfatizar m√°s tus competencias t√©cnicas</small>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



                    <!-- Advanced Metrics Section -->
    {% if analysis.get('metrics') or analysis.get('communication_analysis') or analysis.get('ats_analysis') %}
    <div class="row mb-5">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-line me-2"></i>üìä M√©tricas Avanzadas de An√°lisis
                    </h5>
                </div>
                <div class="card-body">
                    {% if analysis.get('metrics') %}
                    <div class="row mb-4">
                        <div class="col-md-3 col-6 mb-3">
                            <div class="card bg-light">
                                <div class="card-body text-center">
                                    <h4 class="text-primary">{{ analysis.metrics.readability_score or 0 }}%</h4>
                                    <p class="mb-0 small">Legibilidad</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-6 mb-3">
                            <div class="card bg-light">
                                <div class="card-body text-center">
                                    <h4 class="text-success">{{ analysis.metrics.ats_compatibility or 0 }}%</h4>
                                    <p class="mb-0 small">Compatibilidad ATS</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-6 mb-3">
                            <div class="card bg-light">
                                <div class="card-body text-center">
                                    <h4 class="text-info">{{ analysis.metrics.professional_impact or 0 }}%</h4>
                                    <p class="mb-0 small">Impacto Profesional</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-6 mb-3">
                            <div class="card bg-light">
                                <div class="card-body text-center">
                                    <h4 class="text-warning">{{ analysis.metrics.structure_quality or 0 }}%</h4>
                                    <p class="mb-0 small">Calidad Estructura</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    {% if analysis.get('communication_analysis') %}
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-muted mb-3">An√°lisis de Comunicaci√≥n</h6>
                        </div>
                        <div class="col-md-4 col-6 mb-3">
                            <div class="card bg-light">
                                <div class="card-body text-center">
                                    <h5 class="text-primary">{{ analysis.communication_analysis.action_verbs_effectiveness or 0 }}%</h5>
                                    <p class="mb-0 small">Verbos de Acci√≥n</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-6 mb-3">
                            <div class="card bg-light">
                                <div class="card-body text-center">
                                    <h5 class="text-success">{{ analysis.communication_analysis.quantified_achievements or 0 }}%</h5>
                                    <p class="mb-0 small">Logros Cuantificados</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-6 mb-3">
                            <div class="card bg-light">
                                <div class="card-body text-center">
                                    <h5 class="text-info">{{ analysis.communication_analysis.persuasive_impact or 0 }}%</h5>
                                    <p class="mb-0 small">Impacto Persuasivo</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    {% if analysis.get('ats_analysis') %}
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-muted mb-3">Compatibilidad ATS Detallada</h6>
                        </div>
                        <div class="col-md-4 col-6 mb-3">
                            <div class="card bg-light">
                                <div class="card-body text-center">
                                    <h5 class="text-primary">{{ analysis.ats_analysis.parsing_compatibility or 0 }}%</h5>
                                    <p class="mb-0 small">Parsing</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-6 mb-3">
                            <div class="card bg-light">
                                <div class="card-body text-center">
                                    <h5 class="text-success">{{ analysis.ats_analysis.keyword_optimization or 0 }}%</h5>
                                    <p class="mb-0 small">Keywords</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-6 mb-3">
                            <div class="card bg-light">
                                <div class="card-body text-center">
                                    <h5 class="text-info">{{ analysis.ats_analysis.ranking_potential or 0 }}%</h5>
                                    <p class="mb-0 small">Ranking Potencial</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Examples Section -->
    {% if analysis.get('examples') or analysis.get('detailed_examples') or analysis.get('tailoring_examples') or analysis.get('improvement_examples') %}
    <div class="row mb-5">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-lightbulb me-2"></i>üí° Ejemplos Espec√≠ficos y Mejoras
                    </h5>
                </div>
                <div class="card-body">
                    {% if analysis.get('examples') %}
                    <div class="mb-4">
                        {% if analysis.examples.get('spelling_errors') %}
                        <div class="mb-3">
                            <h6 class="text-warning">üîç Errores de Ortograf√≠a Detectados</h6>
                            {% for error in analysis.examples.spelling_errors %}
                            <div class="alert alert-warning py-2">
                                <i class="fas fa-exclamation-triangle me-2"></i>{{ error }}
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}

                        {% if analysis.examples.get('before_after') %}
                        <div class="mb-3">
                            <h6 class="text-success">‚ú® Ejemplos Antes/Despu√©s</h6>
                            {% for example in analysis.examples.before_after %}
                            <div class="alert alert-success py-2">
                                <i class="fas fa-arrow-right me-2"></i>{{ example }}
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}

                    {% if analysis.get('detailed_examples') %}
                    <div class="mb-4">
                        {% if analysis.detailed_examples.get('weak_verbs') %}
                        <div class="mb-3">
                            <h6 class="text-info">üéØ Mejora de Verbos de Acci√≥n</h6>
                            {% for example in analysis.detailed_examples.weak_verbs %}
                            <div class="alert alert-info py-2">
                                <i class="fas fa-lightbulb me-2"></i>{{ example }}
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}

                        {% if analysis.detailed_examples.get('optimization_opportunities') %}
                        <div class="mb-3">
                            <h6 class="text-primary">üöÄ Oportunidades de Optimizaci√≥n</h6>
                            {% for opportunity in analysis.detailed_examples.optimization_opportunities %}
                            <div class="alert alert-primary py-2">
                                <i class="fas fa-chart-line me-2"></i>{{ opportunity }}
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}

                    {% if analysis.get('tailoring_examples') %}
                    <div class="mb-4">
                        {% if analysis.tailoring_examples.get('role_adaptations') %}
                        <div class="mb-3">
                            <h6 class="text-purple">üé≠ Adaptaciones por Rol</h6>
                            {% for adaptation in analysis.tailoring_examples.role_adaptations %}
                            <div class="alert alert-secondary py-2">
                                <i class="fas fa-user-tie me-2"></i>{{ adaptation }}
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}

                    {% if analysis.get('improvement_examples') %}
                    <div class="examples-section mb-4">
                        <h6 class="text-primary">üìù Ejemplos de Mejora Detallados</h6>
                        
                        {% if analysis.improvement_examples.get('spelling_errors') %}
                        <div class="example-category mb-3">
                            <h6 class="text-warning">Errores de Ortograf√≠a Detectados</h6>
                            <div class="error-list">
                                {% for error in analysis.improvement_examples.spelling_errors %}
                                <div class="alert alert-warning py-2">
                                    <span class="error-word">{{ error.word }}</span>
                                    <i class="fas fa-arrow-right mx-2"></i>
                                    <span class="correction">{{ error.correction }}</span>
                                    <small class="context d-block">{{ error.context }}</small>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if analysis.improvement_examples.get('before_after_examples') %}
                        <div class="example-category mb-3">
                            <h6 class="text-success">Ejemplos Antes/Despu√©s</h6>
                            <div class="before-after-list">
                                {% for example in analysis.improvement_examples.before_after_examples %}
                                <div class="alert alert-success py-2">
                                    <div class="before">
                                        <strong>Antes:</strong> {{ example.before }}
                                    </div>
                                    <div class="after">
                                        <strong>Despu√©s:</strong> {{ example.after }}
                                    </div>
                                    <div class="improvement-reason">
                                        <em>{{ example.reason }}</em>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if analysis.improvement_examples.get('weak_phrases') %}
                        <div class="example-category mb-3">
                            <h6 class="text-info">Mejora de Frases D√©biles</h6>
                            <div class="phrase-improvements">
                                {% for phrase in analysis.improvement_examples.weak_phrases %}
                                <div class="alert alert-info py-2">
                                    <div class="original-phrase">
                                        <strong>Original:</strong> {{ phrase.original }}
                                    </div>
                                    <div class="improved-phrase">
                                        <strong>Mejorada:</strong> {{ phrase.improved }}
                                    </div>
                                    <div class="reason">
                                        <em>Raz√≥n: {{ phrase.reason }}</em>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if analysis.improvement_examples.get('tone_adjustments') %}
                        <div class="example-category mb-3">
                            <h6 class="text-primary">Ajustes de Tono</h6>
                            <div class="tone-adjustments">
                                {% for adjustment in analysis.improvement_examples.tone_adjustments %}
                                <div class="alert alert-primary py-2">
                                    <h6>{{ adjustment.section }}</h6>
                                    <p><strong>Tono actual:</strong> {{ adjustment.current_tone }}</p>
                                    <p><strong>Tono recomendado:</strong> {{ adjustment.recommended_tone }}</p>
                                    <p><strong>Ejemplo:</strong> {{ adjustment.example }}</p>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if analysis.improvement_examples.get('weak_verb_improvements') %}
                        <div class="example-category mb-3">
                            <h6 class="text-warning">Mejora de Verbos D√©biles</h6>
                            <div class="verb-improvements">
                                {% for verb in analysis.improvement_examples.weak_verb_improvements %}
                                <div class="alert alert-warning py-2">
                                    <span class="weak-verb">{{ verb.weak_verb }}</span>
                                    <i class="fas fa-arrow-right mx-2"></i>
                                    <span class="strong-verb">{{ verb.strong_verb }}</span>
                                    <small class="impact d-block">Impacto: {{ verb.impact }}</small>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if analysis.improvement_examples.get('optimization_opportunities') %}
                        <div class="example-category mb-3">
                            <h6 class="text-success">Oportunidades de Optimizaci√≥n</h6>
                            <div class="optimization-list">
                                {% for opportunity in analysis.improvement_examples.optimization_opportunities %}
                                <div class="alert alert-success py-2">
                                    <h6>{{ opportunity.section }}</h6>
                                    <p><strong>Sugerencia:</strong> {{ opportunity.suggestion }}</p>
                                    <p><strong>Impacto esperado:</strong> {{ opportunity.expected_impact }}</p>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if analysis.improvement_examples.get('role_adaptations') %}
                        <div class="example-category mb-3">
                            <h6 class="text-secondary">Adaptaciones por Rol</h6>
                            <div class="role-adaptations">
                                {% for adaptation in analysis.improvement_examples.role_adaptations %}
                                <div class="alert alert-secondary py-2">
                                    <h6>{{ adaptation.target_role }}</h6>
                                    <p><strong>Ajustes recomendados:</strong> {{ adaptation.adjustments }}</p>
                                    <p><strong>Keywords clave:</strong> {{ adaptation.key_keywords|join(', ') }}</p>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                    
                    <!-- Nuevas secciones para an√°lisis mejorados -->
                    {% if analysis.get('tone_metrics') %}
                    <div class="tone-metrics-section mb-4">
                        <h6 class="text-info">üìä M√©tricas de Tono y Estilo</h6>
                        <div class="row">
                            <div class="col-md-6 mb-2">
                                <div class="card bg-light">
                                    <div class="card-body text-center py-2">
                                        <h6 class="text-primary">{{ analysis.tone_metrics.professionalism_score or 0 }}%</h6>
                                        <p class="mb-0 small">Profesionalismo</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-2">
                                <div class="card bg-light">
                                    <div class="card-body text-center py-2">
                                        <h6 class="text-success">{{ analysis.tone_metrics.industry_language_score or 0 }}%</h6>
                                        <p class="mb-0 small">Lenguaje Sectorial</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-2">
                                <div class="card bg-light">
                                    <div class="card-body text-center py-2">
                                        <h6 class="text-info">{{ analysis.tone_metrics.readability_score or 0 }}%</h6>
                                        <p class="mb-0 small">Legibilidad</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-2">
                                <div class="card bg-light">
                                    <div class="card-body text-center py-2">
                                        <h6 class="text-warning">{{ analysis.tone_metrics.persuasion_impact_score or 0 }}%</h6>
                                        <p class="mb-0 small">Impacto Persuasivo</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if analysis.get('language_analysis') %}
                    <div class="language-analysis-section mb-4">
                        <h6 class="text-secondary">üî§ An√°lisis de Lenguaje</h6>
                        <div class="row">
                            {% if analysis.language_analysis.get('formal_expressions') %}
                            <div class="col-md-6 mb-3">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6 class="text-success">Expresiones Formales</h6>
                                        <div class="expression-tags">
                                            {% for expr in analysis.language_analysis.formal_expressions %}
                                            <span class="badge bg-success me-1 mb-1">{{ expr }}</span>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                            
                            {% if analysis.language_analysis.get('informal_expressions') %}
                            <div class="col-md-6 mb-3">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6 class="text-warning">Expresiones a Mejorar</h6>
                                        <div class="expression-tags">
                                            {% for expr in analysis.language_analysis.informal_expressions %}
                                            <span class="badge bg-warning me-1 mb-1">{{ expr }}</span>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                            
                            {% if analysis.language_analysis.get('technical_terms_used') %}
                            <div class="col-md-6 mb-3">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6 class="text-info">T√©rminos T√©cnicos</h6>
                                        <div class="expression-tags">
                                            {% for term in analysis.language_analysis.technical_terms_used %}
                                            <span class="badge bg-info me-1 mb-1">{{ term }}</span>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                            
                            {% if analysis.language_analysis.get('missing_industry_terms') %}
                            <div class="col-md-6 mb-3">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6 class="text-danger">T√©rminos Faltantes</h6>
                                        <div class="expression-tags">
                                            {% for term in analysis.language_analysis.missing_industry_terms %}
                                            <span class="badge bg-danger me-1 mb-1">{{ term }}</span>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Keywords Section -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-tags me-2"></i>Palabras Clave Recomendadas
                    </h5>
                </div>
                <div class="card-body">
                    {% if analysis.keywords and analysis.keywords|length > 0 %}
                    <div class="row">
                        {% for keyword in analysis.keywords %}
                        <div class="col-md-3 col-sm-4 col-6 mb-3">
                            <div class="keyword-badge p-2 bg-light rounded text-center">
                                <span class="badge bg-primary p-2">{{ keyword }}</span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <div class="mt-3 small text-muted">
                        <i class="fas fa-info-circle me-1"></i> Incluye estas palabras clave en tu CV para mejorar tu visibilidad en los sistemas ATS.
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-search fa-2x text-muted mb-3"></i>
                        <p class="text-muted">No se identificaron palabras clave espec√≠ficas</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Action Buttons -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="card">
                <div class="card-body text-center py-4">
                    <h5 class="mb-4">¬øQu√© quieres hacer ahora?</h5>
                    <div class="row justify-content-center">
                        <div class="col-md-3 mb-3">
                            <a href="{{ url_for('create_cv') }}" class="btn btn-success btn-lg w-100">
                                <i class="fas fa-file-alt fa-2x mb-2 d-block"></i>
                                Crear Nuevo CV
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="{{ url_for('analyze_cv') }}" class="btn btn-primary btn-lg w-100">
                                <i class="fas fa-robot fa-2x mb-2 d-block"></i>
                                Analizar Otro CV
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="{{ url_for('job_search') }}" class="btn btn-info btn-lg w-100">
                                <i class="fas fa-search fa-2x mb-2 d-block"></i>
                                Buscar Empleos
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <button onclick="downloadReport()" class="btn btn-warning btn-lg w-100">
                                <i class="fas fa-download fa-2x mb-2 d-block"></i>
                                Descargar Reporte
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Improvement Tips -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-graduation-cap me-2"></i>Consejos para Mejorar tu Puntuaci√≥n
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="tip-card p-3 border rounded">
                                <h6 class="text-primary">
                                    <i class="fas fa-key me-2"></i>Optimiza las Palabras Clave
                                </h6>
                                <p class="small text-muted mb-0">
                                    Incluye t√©rminos espec√≠ficos de tu industria y las habilidades mencionadas en las ofertas de trabajo que te interesan.
                                </p>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="tip-card p-3 border rounded">
                                <h6 class="text-success">
                                    <i class="fas fa-chart-line me-2"></i>Cuantifica tus Logros
                                </h6>
                                <p class="small text-muted mb-0">
                                    Usa n√∫meros, porcentajes y m√©tricas espec√≠ficas para demostrar el impacto de tu trabajo.
                                </p>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="tip-card p-3 border rounded">
                                <h6 class="text-info">
                                    <i class="fas fa-align-left me-2"></i>Mejora el Formato
                                </h6>
                                <p class="small text-muted mb-0">
                                    Usa un dise√±o limpio, consistente y f√°cil de leer. Evita fuentes decorativas y colores excesivos.
                                </p>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="tip-card p-3 border rounded">
                                <h6 class="text-warning">
                                    <i class="fas fa-check-double me-2"></i>Revisa la Ortograf√≠a
                                </h6>
                                <p class="small text-muted mb-0">
                                    Aseg√∫rate de que no haya errores ortogr√°ficos o gramaticales. Usa herramientas de correcci√≥n.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Nuevos gr√°ficos para an√°lisis avanzados -->

</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Animate score progress bar
        const scoreProgress = document.getElementById('scoreProgress');
        const targetWidth = parseInt("{{ (analysis.score or 0) | default(0) }}", 10);
        
        setTimeout(() => {
            scoreProgress.style.transition = 'width 2s ease-in-out';
            scoreProgress.style.width = targetWidth + '%';
        }, 500);
        
        // Wait for Chart.js to load, then initialize charts
        function waitForChartJS() {
            if (typeof Chart !== 'undefined') {
                initializeMainCharts();
            } else {
                setTimeout(waitForChartJS, 100);
            }
        }
        
        function initializeMainCharts() {
            const score = parseInt("{{ (analysis.score or 0) | default(0) }}", 10);
            
            // 1. Score Distribution Chart (Doughnut)
            const scoreCanvas = document.getElementById('scoreChart');
            if (scoreCanvas) {
                const scoreCtx = scoreCanvas.getContext('2d');
                const remaining = 100 - score;
                
                new Chart(scoreCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Puntuaci√≥n Obtenida', 'Margen de Mejora'],
                        datasets: [{
                            data: [score, remaining],
                            backgroundColor: [
                                score >= 80 ? '#28a745' : score >= 60 ? '#ffc107' : '#dc3545',
                                '#e9ecef'
                            ],
                            borderWidth: 3,
                            borderColor: '#ffffff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: '#2c3e50',
                                    font: { size: 14, weight: '600' }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.label + ': ' + context.parsed + '%';
                                    }
                                }
                            }
                        },
                        cutout: '65%'
                    }
                });
            }
            
            // 2. Multidimensional Analysis Chart (Radar)
            const radarCanvas = document.getElementById('radarChart');
            if (radarCanvas) {
                const radarCtx = radarCanvas.getContext('2d');
                new Chart(radarCtx, {
                    type: 'radar',
                    data: {
                        labels: ['Contenido', 'Formato', 'Keywords', 'Experiencia', 'Competencias'],
                        datasets: [{
                            label: 'Tu CV',
                            data: [
                                {{ (analysis.content_score or 75) }},
                                {{ (analysis.format_score or 80) }},
                                {{ (analysis.keywords_score or 65) }},
                                {{ (analysis.experience_score or 85) }},
                                {{ (analysis.skills_score or 70) }}
                            ],
                            backgroundColor: 'rgba(40, 167, 69, 0.2)',
                            borderColor: 'rgba(40, 167, 69, 1)',
                            pointBackgroundColor: 'rgba(40, 167, 69, 1)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgba(40, 167, 69, 1)',
                            borderWidth: 2
                        }, {
                            label: 'Promedio del Mercado',
                            data: [70, 75, 60, 70, 65],
                            backgroundColor: 'rgba(108, 117, 125, 0.1)',
                            borderColor: 'rgba(108, 117, 125, 0.8)',
                            pointBackgroundColor: 'rgba(108, 117, 125, 0.8)',
                            pointBorderColor: '#fff',
                            borderWidth: 1,
                            borderDash: [5, 5]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        },
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    stepSize: 20
                                }
                            }
                        }
                    }
                });
            }
            
            // 3. ATS Compatibility Chart (Bar)
            const atsCanvas = document.getElementById('atsChart');
            if (atsCanvas) {
                const atsCtx = atsCanvas.getContext('2d');
                new Chart(atsCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Parsing', 'Keywords', 'Formato', 'Estructura'],
                        datasets: [{
                            label: 'Compatibilidad %',
                            data: [
                                {{ (analysis.ats_parsing or 80) }},
                                {{ (analysis.ats_keywords or 70) }},
                                {{ (analysis.ats_format or 85) }},
                                {{ (analysis.ats_structure or 75) }}
                            ],
                            backgroundColor: 'rgba(23, 162, 184, 0.8)',
                            borderColor: 'rgba(23, 162, 184, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
            }
            
            // 4. Category Analysis Chart (Radar)
            const categoryCanvas = document.getElementById('categoryChart');
            if (categoryCanvas) {
                const categoryCtx = categoryCanvas.getContext('2d');
                
                // Use real metrics if available, otherwise simulate
                const baseScore = score;
                
                {% if analysis.get('metrics') %}
                const categories = {
                    'Legibilidad': {{ analysis.metrics.readability_score or 0 }},
                    'ATS Compatibility': {{ analysis.metrics.ats_compatibility or 0 }},
                    'Impacto Profesional': {{ analysis.metrics.professional_impact or 0 }},
                    'Calidad Estructura': {{ analysis.metrics.structure_quality or 0 }},
                    'Puntuaci√≥n General': baseScore
                };
                {% elif analysis.get('communication_analysis') %}
                const categories = {
                    'Verbos de Acci√≥n': {{ analysis.communication_analysis.action_verbs_effectiveness or 0 }},
                    'Logros Cuantificados': {{ analysis.communication_analysis.quantified_achievements or 0 }},
                    'Claridad': {{ analysis.communication_analysis.clarity_score or 0 }},
                    'Profesionalismo': {{ analysis.communication_analysis.professionalism_level or 0 }},
                    'Impacto Persuasivo': {{ analysis.communication_analysis.persuasive_impact or 0 }}
                };
                {% elif analysis.get('ats_analysis') %}
                const categories = {
                    'Parsing': {{ analysis.ats_analysis.parsing_compatibility or 0 }},
                    'Keywords': {{ analysis.ats_analysis.keyword_optimization or 0 }},
                    'Estructura': {{ analysis.ats_analysis.structure_quality or 0 }},
                    'Formato': {{ analysis.ats_analysis.format_compliance or 0 }},
                    'Ranking Potencial': {{ analysis.ats_analysis.ranking_potential or 0 }}
                };
                {% else %}
                const categories = {
                    'Experiencia': Math.min(100, baseScore + Math.random() * 20 - 10),
                    'Habilidades': Math.min(100, baseScore + Math.random() * 20 - 10),
                    'Educaci√≥n': Math.min(100, baseScore + Math.random() * 20 - 10),
                    'Formato': Math.min(100, baseScore + Math.random() * 20 - 10),
                    'Palabras Clave': Math.min(100, baseScore + Math.random() * 20 - 10)
                };
                {% endif %}
                
                new Chart(categoryCtx, {
                    type: 'radar',
                    data: {
                        labels: Object.keys(categories),
                        datasets: [{
                            label: 'Tu Puntuaci√≥n',
                            data: Object.values(categories),
                            backgroundColor: 'rgba(52, 152, 219, 0.3)',
                            borderColor: 'rgba(52, 152, 219, 1)',
                            borderWidth: 3,
                            pointBackgroundColor: 'rgba(52, 152, 219, 1)',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgba(52, 152, 219, 1)',
                            pointHoverRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    stepSize: 20,
                                    color: '#2c3e50',
                                    font: { size: 12, weight: '600' }
                                },
                                pointLabels: {
                                    color: '#2c3e50',
                                    font: { size: 13, weight: '600' }
                                },
                                grid: { color: 'rgba(44, 62, 80, 0.2)' },
                                angleLines: { color: 'rgba(44, 62, 80, 0.2)' }
                            }
                        },
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            }
        }
        
        // Start the chart initialization process
        waitForChartJS();


        
        // Tone Metrics Chart
        {% if analysis.get('tone_metrics') %}
        const toneCtx = document.getElementById('toneMetricsChart').getContext('2d');
        new Chart(toneCtx, {
            type: 'radar',
            data: {
                labels: [
                    'Profesionalismo',
                    'Lenguaje Sectorial',
                    'Legibilidad',
                    'Impacto Persuasivo',
                    'Consistencia'
                ],
                datasets: [{
                    label: 'M√©tricas de Tono',
                    data: [
                        {{ analysis.tone_metrics.professionalism_score or 0 }},
                        {{ analysis.tone_metrics.industry_language_score or 0 }},
                        {{ analysis.tone_metrics.readability_score or 0 }},
                        {{ analysis.tone_metrics.persuasion_impact_score or 0 }},
                        {{ analysis.tone_metrics.consistency_score or 0 }}
                    ],
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    pointBackgroundColor: 'rgba(54, 162, 235, 1)',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: 'rgba(54, 162, 235, 1)'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'An√°lisis de Tono y Estilo'
                    }
                },
                scales: {
                    r: {
                        beginAtZero: true,
                        max: 100
                    }
                }
            }
        });
        {% endif %}
        
        // Industry Analysis Chart
        {% if analysis.get('industry_analysis') %}
        const industryCtx = document.getElementById('industryAnalysisChart').getContext('2d');
        new Chart(industryCtx, {
            type: 'doughnut',
            data: {
                labels: [
                    'Alineaci√≥n con Industria',
                    'Relevancia de Experiencia',
                    'Competencias T√©cnicas',
                    'Soft Skills',
                    'Certificaciones'
                ],
                datasets: [{
                    data: [
                        {{ analysis.industry_analysis.industry_alignment_score or 0 }},
                        {{ analysis.industry_analysis.experience_relevance_score or 0 }},
                        {{ analysis.industry_analysis.technical_skills_score or 0 }},
                        {{ analysis.industry_analysis.soft_skills_score or 0 }},
                        {{ analysis.industry_analysis.certifications_score or 0 }}
                    ],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.8)',
                        'rgba(54, 162, 235, 0.8)',
                        'rgba(255, 205, 86, 0.8)',
                        'rgba(75, 192, 192, 0.8)',
                        'rgba(153, 102, 255, 0.8)'
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'An√°lisis por Industria'
                    },
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
        {% endif %}
        
        // Design Assessment Chart
        {% if analysis.get('design_metrics') %}
        const designCtx = document.getElementById('designAssessmentChart').getContext('2d');
        new Chart(designCtx, {
            type: 'bar',
            data: {
                labels: [
                    'Legibilidad Visual',
                    'Estructura',
                    'Consistencia',
                    'Profesionalismo',
                    'Compatibilidad'
                ],
                datasets: [{
                    label: 'Puntuaci√≥n de Dise√±o',
                    data: [
                        {{ analysis.design_metrics.visual_readability_score or 0 }},
                        {{ analysis.design_metrics.structure_score or 0 }},
                        {{ analysis.design_metrics.consistency_score or 0 }},
                        {{ analysis.design_metrics.professionalism_score or 0 }},
                        {{ analysis.design_metrics.compatibility_score or 0 }}
                    ],
                    backgroundColor: 'rgba(75, 192, 192, 0.8)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'Evaluaci√≥n de Dise√±o Visual'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100
                    }
                }
            }
        });
        {% endif %}
        
        // AI Insights Chart
        {% if analysis.get('ai_insights') %}
        const aiCtx = document.getElementById('aiInsightsChart').getContext('2d');
        new Chart(aiCtx, {
            type: 'line',
            data: {
                labels: [
                    'Optimizaci√≥n Actual',
                    'Potencial de Mejora',
                    'Competitividad',
                    'Tendencias de Mercado',
                    'Predicci√≥n de √âxito'
                ],
                datasets: [{
                    label: 'Puntuaci√≥n Actual',
                    data: [
                        {{ analysis.ai_insights.current_optimization_score or 0 }},
                        {{ analysis.ai_insights.improvement_potential_score or 0 }},
                        {{ analysis.ai_insights.competitiveness_score or 0 }},
                        {{ analysis.ai_insights.market_trends_alignment_score or 0 }},
                        {{ analysis.ai_insights.success_prediction_score or 0 }}
                    ],
                    borderColor: 'rgba(255, 99, 132, 1)',
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    tension: 0.4
                }, {
                    label: 'Potencial Optimizado',
                    data: [
                        Math.min(100, {{ analysis.ai_insights.current_optimization_score or 0 }} + 15),
                        Math.min(100, {{ analysis.ai_insights.improvement_potential_score or 0 }} + 20),
                        Math.min(100, {{ analysis.ai_insights.competitiveness_score or 0 }} + 18),
                        Math.min(100, {{ analysis.ai_insights.market_trends_alignment_score or 0 }} + 12),
                        Math.min(100, {{ analysis.ai_insights.success_prediction_score or 0 }} + 25)
                    ],
                    borderColor: 'rgba(54, 162, 235, 1)',
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    tension: 0.4,
                    borderDash: [5, 5]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'An√°lisis de IA y Potencial de Optimizaci√≥n'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100
                    }
                }
            }
        });
        {% endif %}
        
        // Market Analysis Chart
        {% if analysis.get('market_analysis') %}
        const marketCtx = document.getElementById('marketChart').getContext('2d');
        new Chart(marketCtx, {
            type: 'bar',
            data: {
                labels: ['Alineaci√≥n Industria', 'Optimizaci√≥n Keywords', 'Transferibilidad Skills', 'Posicionamiento Competitivo', 'Preparaci√≥n Mercado', 'Potencial Crecimiento'],
                datasets: [{
                    label: 'Puntuaci√≥n',
                    data: [
                        {{ analysis.market_analysis.industry_alignment or 0 }},
                        {{ analysis.market_analysis.keyword_optimization or 0 }},
                        {{ analysis.market_analysis.skills_transferability or 0 }},
                        {{ analysis.market_analysis.competitive_positioning or 0 }},
                        {{ analysis.market_analysis.market_readiness or 0 }},
                        {{ analysis.market_analysis.growth_potential or 0 }}
                    ],
                    backgroundColor: [
                        'rgba(52, 152, 219, 0.8)',
                        'rgba(46, 204, 113, 0.8)',
                        'rgba(155, 89, 182, 0.8)',
                        'rgba(241, 196, 15, 0.8)',
                        'rgba(230, 126, 34, 0.8)',
                        'rgba(231, 76, 60, 0.8)'
                    ],
                    borderColor: [
                        'rgba(52, 152, 219, 1)',
                        'rgba(46, 204, 113, 1)',
                        'rgba(155, 89, 182, 1)',
                        'rgba(241, 196, 15, 1)',
                        'rgba(230, 126, 34, 1)',
                        'rgba(231, 76, 60, 1)'
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            color: '#2c3e50',
                            font: { size: 12, weight: '600' }
                        }
                    },
                    x: {
                        ticks: {
                            color: '#2c3e50',
                            font: { size: 11, weight: '600' },
                            maxRotation: 45
                        }
                    }
                },
                plugins: {
                    legend: { display: false }
                }
            }
        });
        {% endif %}
        
        // Content Analysis Chart
        {% if analysis.get('content_analysis') %}
        const contentCtx = document.getElementById('contentChart').getContext('2d');
        new Chart(contentCtx, {
            type: 'doughnut',
            data: {
                labels: ['Relevancia Experiencia', 'Alineaci√≥n Skills', 'Impacto Logros', 'Valor Educaci√≥n', 'Progresi√≥n Carrera', 'Competitividad Mercado'],
                datasets: [{
                    data: [
                        {{ analysis.content_analysis.experience_relevance or 0 }},
                        {{ analysis.content_analysis.skills_alignment or 0 }},
                        {{ analysis.content_analysis.achievements_impact or 0 }},
                        {{ analysis.content_analysis.education_value or 0 }},
                        {{ analysis.content_analysis.career_progression or 0 }},
                        {{ analysis.content_analysis.market_competitiveness or 0 }}
                    ],
                    backgroundColor: [
                        'rgba(52, 152, 219, 0.8)',
                        'rgba(46, 204, 113, 0.8)',
                        'rgba(155, 89, 182, 0.8)',
                        'rgba(241, 196, 15, 0.8)',
                        'rgba(230, 126, 34, 0.8)',
                        'rgba(231, 76, 60, 0.8)'
                    ],
                    borderColor: '#fff',
                    borderWidth: 3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: '#2c3e50',
                            font: { size: 11, weight: '600' },
                            padding: 15
                        }
                    }
                }
            }
        });
        {% endif %}
        
        // ATS Compatibility Matrix Chart
        {% if analysis.get('ats_compatibility_matrix') %}
        const atsMatrixCtx = document.getElementById('atsMatrixChart').getContext('2d');
        new Chart(atsMatrixCtx, {
            type: 'bar',
            data: {
                labels: ['Workday', 'Taleo', 'iCIMS', 'Greenhouse', 'ATS General'],
                datasets: [{
                    label: 'Compatibilidad (%)',
                    data: [
                        {{ analysis.ats_compatibility_matrix.workday_score or 0 }},
                        {{ analysis.ats_compatibility_matrix.taleo_score or 0 }},
                        {{ analysis.ats_compatibility_matrix.icims_score or 0 }},
                        {{ analysis.ats_compatibility_matrix.greenhouse_score or 0 }},
                        {{ analysis.ats_compatibility_matrix.general_ats_score or 0 }}
                    ],
                    backgroundColor: [
                        {% set workday_score = analysis.ats_compatibility_matrix.workday_score or 0 %}
                        {% if workday_score >= 80 %}'rgba(46, 204, 113, 0.8)'{% elif workday_score >= 60 %}'rgba(241, 196, 15, 0.8)'{% else %}'rgba(231, 76, 60, 0.8)'{% endif %},
                        {% set taleo_score = analysis.ats_compatibility_matrix.taleo_score or 0 %}
                        {% if taleo_score >= 80 %}'rgba(46, 204, 113, 0.8)'{% elif taleo_score >= 60 %}'rgba(241, 196, 15, 0.8)'{% else %}'rgba(231, 76, 60, 0.8)'{% endif %},
                        {% set icims_score = analysis.ats_compatibility_matrix.icims_score or 0 %}
                        {% if icims_score >= 80 %}'rgba(46, 204, 113, 0.8)'{% elif icims_score >= 60 %}'rgba(241, 196, 15, 0.8)'{% else %}'rgba(231, 76, 60, 0.8)'{% endif %},
                        {% set greenhouse_score = analysis.ats_compatibility_matrix.greenhouse_score or 0 %}
                        {% if greenhouse_score >= 80 %}'rgba(46, 204, 113, 0.8)'{% elif greenhouse_score >= 60 %}'rgba(241, 196, 15, 0.8)'{% else %}'rgba(231, 76, 60, 0.8)'{% endif %},
                        {% set general_score = analysis.ats_compatibility_matrix.general_ats_score or 0 %}
                        {% if general_score >= 80 %}'rgba(46, 204, 113, 0.8)'{% elif general_score >= 60 %}'rgba(241, 196, 15, 0.8)'{% else %}'rgba(231, 76, 60, 0.8)'{% endif %}
                    ],
                    borderColor: [
                        {% set workday_score = analysis.ats_compatibility_matrix.workday_score or 0 %}
                        {% if workday_score >= 80 %}'rgba(46, 204, 113, 1)'{% elif workday_score >= 60 %}'rgba(241, 196, 15, 1)'{% else %}'rgba(231, 76, 60, 1)'{% endif %},
                        {% set taleo_score = analysis.ats_compatibility_matrix.taleo_score or 0 %}
                        {% if taleo_score >= 80 %}'rgba(46, 204, 113, 1)'{% elif taleo_score >= 60 %}'rgba(241, 196, 15, 1)'{% else %}'rgba(231, 76, 60, 1)'{% endif %},
                        {% set icims_score = analysis.ats_compatibility_matrix.icims_score or 0 %}
                        {% if icims_score >= 80 %}'rgba(46, 204, 113, 1)'{% elif icims_score >= 60 %}'rgba(241, 196, 15, 1)'{% else %}'rgba(231, 76, 60, 1)'{% endif %},
                        {% set greenhouse_score = analysis.ats_compatibility_matrix.greenhouse_score or 0 %}
                        {% if greenhouse_score >= 80 %}'rgba(46, 204, 113, 1)'{% elif greenhouse_score >= 60 %}'rgba(241, 196, 15, 1)'{% else %}'rgba(231, 76, 60, 1)'{% endif %},
                        {% set general_score = analysis.ats_compatibility_matrix.general_ats_score or 0 %}
                        {% if general_score >= 80 %}'rgba(46, 204, 113, 1)'{% elif general_score >= 60 %}'rgba(241, 196, 15, 1)'{% else %}'rgba(231, 76, 60, 1)'{% endif %}
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            color: '#2c3e50',
                            font: { size: 12, weight: '600' },
                            callback: function(value) {
                                return value + '%';
                            }
                        }
                    },
                    x: {
                        ticks: {
                            color: '#2c3e50',
                            font: { size: 12, weight: '600' }
                        }
                    }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.parsed.y + '% de compatibilidad';
                            }
                        }
                    }
                }
            }
        });
        {% endif %}
        

        
        // Initialize charts after ensuring Chart.js is loaded
        function initializeCharts() {
            if (typeof Chart === 'undefined') {
                console.error('Chart.js no est√° cargado');
                return;
            }
            
            // Score Distribution Chart (Pie Chart)
            const scoreCanvas = document.getElementById('scoreChart');
            if (scoreCanvas) {
                const scoreCtx = scoreCanvas.getContext('2d');
                const totalScore = parseInt("{{ (analysis.score or 0) | default(0) }}", 10);
                
                let excellentScore = 0, goodScore = 0, improvableScore = 0;
                if (totalScore >= 80) {
                    excellentScore = totalScore;
                } else if (totalScore >= 60) {
                    goodScore = totalScore;
                } else {
                    improvableScore = totalScore;
                }
                
                new Chart(scoreCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Excelente (80-100%)', 'Bueno (60-79%)', 'Mejorable (0-59%)'],
                        datasets: [{
                            data: [excellentScore, goodScore, improvableScore],
                            backgroundColor: [
                                'rgba(40, 167, 69, 0.8)',
                                'rgba(255, 193, 7, 0.8)',
                                'rgba(220, 53, 69, 0.8)'
                            ],
                            borderColor: [
                                'rgba(40, 167, 69, 1)',
                                'rgba(255, 193, 7, 1)',
                                'rgba(220, 53, 69, 1)'
                            ],
                            borderWidth: 3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: '#2c3e50',
                                    font: { size: 12, weight: '600' },
                                    padding: 15
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.label + ': ' + context.parsed + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        
            // Radar Chart for Multidimensional Analysis
            const radarCanvas = document.getElementById('radarChart');
            if (radarCanvas) {
                const radarCtx = radarCanvas.getContext('2d');
                
                const radarData = {
                    'Contenido': {{ (analysis.content_score or 75) }},
                    'Formato': {{ (analysis.format_score or 80) }},
                    'Keywords': {{ (analysis.keywords_score or 65) }},
                    'Experiencia': {{ (analysis.experience_score or 85) }},
                    'Competencias': {{ (analysis.skills_score or 70) }}
                };
                
                new Chart(radarCtx, {
                    type: 'radar',
                    data: {
                        labels: Object.keys(radarData),
                        datasets: [{
                            label: 'Tu Puntuaci√≥n',
                            data: Object.values(radarData),
                            backgroundColor: 'rgba(40, 167, 69, 0.3)',
                            borderColor: 'rgba(40, 167, 69, 1)',
                            borderWidth: 3,
                            pointBackgroundColor: 'rgba(40, 167, 69, 1)',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgba(40, 167, 69, 1)',
                            pointHoverRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    stepSize: 20,
                                    color: '#2c3e50',
                                    font: { size: 12, weight: '600' }
                                },
                                pointLabels: {
                                    color: '#2c3e50',
                                    font: { size: 13, weight: '600' }
                                },
                                grid: { color: 'rgba(44, 62, 80, 0.2)' },
                                angleLines: { color: 'rgba(44, 62, 80, 0.2)' }
                            }
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.label + ': ' + context.parsed + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        
            // ATS Compatibility Chart
            const atsCanvas = document.getElementById('atsChart');
            if (atsCanvas) {
                const atsCtx = atsCanvas.getContext('2d');
                const atsScore = {{ (analysis.ats_compatibility_score or 75) }};
                
                new Chart(atsCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Parsing', 'Keywords', 'Formato', 'Estructura', 'Compatibilidad General'],
                        datasets: [{
                            label: 'Compatibilidad ATS',
                            data: [
                                Math.max(0, atsScore - 10 + Math.random() * 20),
                                Math.max(0, atsScore - 5 + Math.random() * 15),
                                Math.max(0, atsScore + Math.random() * 10),
                                Math.max(0, atsScore - 8 + Math.random() * 16),
                                atsScore
                            ],
                            backgroundColor: 'rgba(23, 162, 184, 0.8)',
                            borderColor: 'rgba(23, 162, 184, 1)',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    color: '#2c3e50',
                                    font: { size: 12, weight: '600' },
                                    callback: function(value) { return value + '%'; }
                                }
                            },
                            x: {
                                ticks: {
                                    color: '#2c3e50',
                                    font: { size: 11, weight: '600' },
                                    maxRotation: 45
                                }
                            }
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.parsed.y + '% de compatibilidad';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        
            // Skills Analysis Chart
            const skillsCanvas = document.getElementById('skillsChart');
            if (skillsCanvas) {
                const skillsCtx = skillsCanvas.getContext('2d');
                const technicalSkills = {{ (analysis.technical_skills_count or 15) }};
                const softSkills = {{ (analysis.soft_skills_count or 8) }};
                
                new Chart(skillsCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Habilidades T√©cnicas', 'Habilidades Blandas'],
                        datasets: [{
                            data: [technicalSkills, softSkills],
                            backgroundColor: [
                                'rgba(23, 162, 184, 0.8)',
                                'rgba(255, 193, 7, 0.8)'
                            ],
                            borderColor: [
                                'rgba(23, 162, 184, 1)',
                                'rgba(255, 193, 7, 1)'
                            ],
                            borderWidth: 3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: '#2c3e50',
                                    font: { size: 12, weight: '600' },
                                    padding: 15
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const total = technicalSkills + softSkills;
                                        const percentage = ((context.parsed / total) * 100).toFixed(1);
                                        return context.label + ': ' + context.parsed + ' (' + percentage + '%)';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Initialize charts when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeCharts);
        } else {
            // DOM is already loaded
            setTimeout(initializeCharts, 100);
        }
        
        // Animate cards on scroll
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);
        
        // Observe analysis items
        document.querySelectorAll('.strength-item, .weakness-item, .recommendation-item').forEach(item => {
            item.style.opacity = '0';
            item.style.transform = 'translateY(20px)';
            item.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
            observer.observe(item);
        });
    });
    
    // Download report function
    function downloadReport() {
        // Create a simple text report
        const score = parseInt("{{ (analysis.score or 0) | default(0) }}", 10);
        const strengths = JSON.parse('{{ analysis.strengths | tojson | safe }}');
        const weaknesses = JSON.parse('{{ analysis.weaknesses | tojson | safe }}');
        const recommendations = JSON.parse('{{ analysis.recommendations | tojson | safe }}');
        const keywords = {{ analysis.keywords | tojson | safe }};
        
        let report = "REPORTE DE AN√ÅLISIS DE CV\n";
        report += "================================\n\n";
        report += "PUNTUACI√ìN GENERAL: " + score + "%\n\n";
        
        report += "FORTALEZAS:\n";
        strengths.forEach(function(strength, index) {
            report += (index + 1) + ". " + strength + "\n";
        });
        
        report += "\n√ÅREAS DE MEJORA:\n";
        weaknesses.forEach(function(weakness, index) {
            report += (index + 1) + ". " + weakness + "\n";
        });
        
        report += "\nRECOMENDACIONES:\n";
        recommendations.forEach(function(recommendation, index) {
            report += (index + 1) + ". " + recommendation + "\n";
        });
        
        report += "\nPALABRAS CLAVE RECOMENDADAS:\n";
        if (keywords && keywords.length > 0) {
            keywords.forEach(function(keyword, index) {
                report += (index + 1) + ". " + keyword + "\n";
            });
        } else {
            report += "No se identificaron palabras clave espec√≠ficas.\n";
        }
        
        report += "\n\nGenerado por ARMind CVs\n";
        report += "Fecha: " + new Date().toLocaleDateString('es-ES');
        
        // Create and download file
        const blob = new Blob([report], { type: 'text/plain' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = "reporte_analisis_cv_" + new Date().getTime() + ".txt";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
    }
</script>
{% endblock %}